<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A guide to building DevTest Labs Policies ARM templates."><title>Building DevTest Labs ARM Template Policies</title><link rel=canonical href=https://blog.mattdaines.me/p/building-devtest-labs-arm-template-policies/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Building DevTest Labs ARM Template Policies"><meta property="og:description" content="A guide to building DevTest Labs Policies ARM templates."><meta property="og:url" content="https://blog.mattdaines.me/p/building-devtest-labs-arm-template-policies/"><meta property="og:site_name" content="Matt Daines"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Azure"><meta property="article:tag" content="DevTest Labs"><meta property="article:tag" content="ARM Templates"><meta property="article:published_time" content="2021-02-15T00:00:00+00:00"><meta property="article:modified_time" content="2021-02-15T00:00:00+00:00"><meta name=twitter:title content="Building DevTest Labs ARM Template Policies"><meta name=twitter:description content="A guide to building DevTest Labs Policies ARM templates."></head><body><script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.body.dataset.scheme='dark':document.body.dataset.scheme='light'})()</script><div class="container main-container flex on-phone--column extended article-page with-toolbar"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hu1f9973605cefc906a06aa7420d62a8b9_6051_300x0_resize_q75_box.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>üë®üèª‚Äçüíª</span></figure><h1 class=site-name><a href=https://blog.mattdaines.me>Matt Daines</a></h1><h2 class=site-description>An Azure engineer's scrapbook.</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/about><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></ol></aside><main class="main full-width"><div id=article-toolbar><a href=https://blog.mattdaines.me class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/azure/>Azure</a>
<a href=/categories/iac/>Infrastrucure-as-Code</a></header><h2 class=article-title><a href=/p/building-devtest-labs-arm-template-policies/>Building DevTest Labs ARM Template Policies</a></h2><h3 class=article-subtitle>A guide to building DevTest Labs Policies ARM templates.</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Feb 15, 2021</time></footer></div></header><section class=article-content><p>I&rsquo;ve recently been ARM templating again! In this article I&rsquo;ll go through how I&rsquo;ve templated a relatively troublesome resource: <code>Microsoft.DevTestLab/labs/policysets/policies</code>. The documentation for this resource type is quite scarce so I figured I&rsquo;d try figure out how to template at least some of the policies. Maybe you&rsquo;ll find something useful.</p><h3 id=devtest-labs-parent-resource>DevTest Labs Parent Resource</h3><p>This resource is relatively simple; shouldn&rsquo;t have too much of an issue here! Not going into detail here but for completeness, this is what I used as my parent.</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;[parameters(&#39;devTestLabName&#39;)]&#34;</span><span class=p>,</span>
  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;Microsoft.DevTestLab/labs&#34;</span><span class=p>,</span>
  <span class=nt>&#34;apiVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;2018-09-15&#34;</span><span class=p>,</span>
  <span class=nt>&#34;location&#34;</span><span class=p>:</span> <span class=s2>&#34;[parameters(&#39;location&#39;)]&#34;</span><span class=p>,</span>
  <span class=nt>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
    <span class=nt>&#34;labStorageType&#34;</span><span class=p>:</span> <span class=s2>&#34;Premium&#34;</span><span class=p>,</span>
    <span class=nt>&#34;premiumDataDisks&#34;</span><span class=p>:</span> <span class=s2>&#34;Enabled&#34;</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h3 id=userownedlabvmcount>UserOwnedLabVmCount</h3><p>This is where I first realised that threshold only accepts a string. My first assumption was that another field (factData) held strings and threshold held integers. That&rsquo;s not the case.</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;[concat(parameters(&#39;devTestLabName&#39;), &#39;/default/UserOwnedLabVmCount&#39;)]&#34;</span><span class=p>,</span>
  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;Microsoft.DevTestLab/labs/policysets/policies&#34;</span><span class=p>,</span>
  <span class=nt>&#34;apiVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;2018-09-15&#34;</span><span class=p>,</span>
  <span class=nt>&#34;dependsOn&#34;</span><span class=p>:</span> <span class=p>[</span>
    <span class=s2>&#34;[resourceId(&#39;Microsoft.DevTestLab/labs&#39;, parameters(&#39;devTestLabName&#39;))]&#34;</span>
  <span class=p>],</span>
  <span class=nt>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
    <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;Enabled&#34;</span><span class=p>,</span>
    <span class=nt>&#34;factName&#34;</span><span class=p>:</span> <span class=s2>&#34;UserOwnedLabVmCount&#34;</span><span class=p>,</span>
    <span class=nt>&#34;threshold&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span>
    <span class=nt>&#34;evaluatorType&#34;</span><span class=p>:</span> <span class=s2>&#34;MaxValuePolicy&#34;</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>There doesn&rsquo;t appear to be a max value for UserOwnedLabVmCount. I tried 999,999 and it took. If that&rsquo;s something you&rsquo;d like to control in a parameter you can use a parameter of type int where you can set maxValue then for the threshold property use:</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=s2>&#34;threshold&#34;</span><span class=err>:</span> <span class=s2>&#34;[string(parameter(&#39;UserOwnedLabVmCountValue&#39;))]&#34;</span>
</code></pre></div><h3 id=userownedlabpremiumvmcount>UserOwnedLabPremiumVmCount</h3><p>Practically identical to the above!</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;[concat(parameters(&#39;devTestLabName&#39;), &#39;/default/UserOwnedLabPremiumVmCount&#39;)]&#34;</span><span class=p>,</span>
  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;Microsoft.DevTestLab/labs/policysets/policies&#34;</span><span class=p>,</span>
  <span class=nt>&#34;apiVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;2018-09-15&#34;</span><span class=p>,</span>
  <span class=nt>&#34;dependsOn&#34;</span><span class=p>:</span> <span class=p>[</span>
    <span class=s2>&#34;[resourceId(&#39;Microsoft.DevTestLab/labs&#39;, parameters(&#39;devTestLabName&#39;))]&#34;</span>
  <span class=p>],</span>
  <span class=nt>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
    <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;Enabled&#34;</span><span class=p>,</span>
    <span class=nt>&#34;factName&#34;</span><span class=p>:</span> <span class=s2>&#34;UserOwnedLabPremiumVmCount&#34;</span><span class=p>,</span>
    <span class=nt>&#34;threshold&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span>
    <span class=nt>&#34;evaluatorType&#34;</span><span class=p>:</span> <span class=s2>&#34;MaxValuePolicy&#34;</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h3 id=labvmcount>LabVmCount</h3><p>Another practically identical resource to the two previous policies&mldr; If only they were all this easy!</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;[concat(parameters(&#39;devTestLabName&#39;), &#39;/default/LabVmCount&#39;)]&#34;</span><span class=p>,</span>
  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;Microsoft.DevTestLab/labs/policysets/policies&#34;</span><span class=p>,</span>
  <span class=nt>&#34;apiVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;2018-09-15&#34;</span><span class=p>,</span>
  <span class=nt>&#34;dependsOn&#34;</span><span class=p>:</span> <span class=p>[</span>
    <span class=s2>&#34;[resourceId(&#39;Microsoft.DevTestLab/labs&#39;, parameters(&#39;devTestLabName&#39;))]&#34;</span>
  <span class=p>],</span>
  <span class=nt>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
    <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;Enabled&#34;</span><span class=p>,</span>
    <span class=nt>&#34;factName&#34;</span><span class=p>:</span> <span class=s2>&#34;LabVmCount&#34;</span><span class=p>,</span>
    <span class=nt>&#34;threshold&#34;</span><span class=p>:</span> <span class=s2>&#34;10&#34;</span><span class=p>,</span>
    <span class=nt>&#34;evaluatorType&#34;</span><span class=p>:</span> <span class=s2>&#34;MaxValuePolicy&#34;</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h3 id=labpremiumvmcount>LabPremiumVmCount</h3><p>And again&mldr; But this time a little caveat. This policy requires that the DevTest lab property <code>labStorageType</code> is set to <code>Premium</code>. ARM will throw a seemingly unrelated error if this is not set. I learnt this as initially my DevTest lab was set to StandardSSD.</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;[concat(parameters(&#39;devTestLabName&#39;), &#39;/default/LabPremiumVmCount&#39;)]&#34;</span><span class=p>,</span>
  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;Microsoft.DevTestLab/labs/policysets/policies&#34;</span><span class=p>,</span>
  <span class=nt>&#34;apiVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;2018-09-15&#34;</span><span class=p>,</span>
  <span class=nt>&#34;dependsOn&#34;</span><span class=p>:</span> <span class=p>[</span>
    <span class=s2>&#34;[resourceId(&#39;Microsoft.DevTestLab/labs&#39;, parameters(&#39;devTestLabName&#39;))]&#34;</span>
  <span class=p>],</span>
  <span class=nt>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
    <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;Enabled&#34;</span><span class=p>,</span>
    <span class=nt>&#34;factName&#34;</span><span class=p>:</span> <span class=s2>&#34;LabPremiumVmCount&#34;</span><span class=p>,</span>
    <span class=nt>&#34;threshold&#34;</span><span class=p>:</span> <span class=s2>&#34;10&#34;</span><span class=p>,</span>
    <span class=nt>&#34;evaluatorType&#34;</span><span class=p>:</span> <span class=s2>&#34;MaxValuePolicy&#34;</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h3 id=labvmsize>LabVmSize</h3><p>Okay, this one is different. Really. It&rsquo;s our first policy that doesn&rsquo;t just require a integer (.. as a string).</p><p>The solution for LabVmSize is to use a parameter of type array and parse that as a string. The array is just your standard Azure VM sizes in a list. To be verbose, this is the template resource component:</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;[concat(parameters(&#39;devTestLabName&#39;), &#39;/default/LabVmSize&#39;)]&#34;</span><span class=p>,</span>
  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;Microsoft.DevTestLab/labs/policysets/policies&#34;</span><span class=p>,</span>
  <span class=nt>&#34;apiVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;2018-09-15&#34;</span><span class=p>,</span>
  <span class=nt>&#34;dependsOn&#34;</span><span class=p>:</span> <span class=p>[</span>
    <span class=s2>&#34;[resourceId(&#39;Microsoft.DevTestLab/labs&#39;, parameters(&#39;devTestLabName&#39;))]&#34;</span>
  <span class=p>],</span>
  <span class=nt>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
    <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;Enabled&#34;</span><span class=p>,</span>
    <span class=nt>&#34;factName&#34;</span><span class=p>:</span> <span class=s2>&#34;LabVmSize&#34;</span><span class=p>,</span>
    <span class=nt>&#34;threshold&#34;</span><span class=p>:</span> <span class=s2>&#34;[string(parameters(&#39;allowedLabVmSizes&#39;))]&#34;</span><span class=p>,</span>
    <span class=nt>&#34;evaluatorType&#34;</span><span class=p>:</span> <span class=s2>&#34;AllowedValuesPolicy&#34;</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>And the parameter component:</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=s2>&#34;allowedLabVmSizes&#34;</span><span class=err>:</span> <span class=p>{</span>
  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>[</span>
    <span class=s2>&#34;Basic_A0&#34;</span><span class=p>,</span>
    <span class=s2>&#34;Basic_A1&#34;</span><span class=p>,</span>
    <span class=s2>&#34;Basic_A2&#34;</span><span class=p>,</span>
    <span class=s2>&#34;Basic_A3&#34;</span><span class=p>,</span>
    <span class=s2>&#34;Basic_A4&#34;</span>
  <span class=p>]</span>
<span class=p>}</span>
</code></pre></div><h3 id=galleryimage>GalleryImage</h3><p>This one beat me. I searched for <code>"/default/GalleryImage"</code> and found another blog that had managed to template this value. I wonder if they struggled as much as I did.</p><p>At first glance this policy is very similar to the one directly above. It accepts a JSON array as a string containing the usual details about the image reference. But for reasons that are beyond my comprehension they wouldn&rsquo;t stick. So, this is the template:</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;[concat(parameters(&#39;devTestLabName&#39;), &#39;/default/GalleryImage&#39;)]&#34;</span><span class=p>,</span>
  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;Microsoft.DevTestLab/labs/policysets/policies&#34;</span><span class=p>,</span>
  <span class=nt>&#34;apiVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;2018-09-15&#34;</span><span class=p>,</span>
  <span class=nt>&#34;dependsOn&#34;</span><span class=p>:</span> <span class=p>[</span>
    <span class=s2>&#34;[resourceId(&#39;Microsoft.DevTestLab/labs&#39;, parameters(&#39;devTestLabName&#39;))]&#34;</span>
  <span class=p>],</span>
  <span class=nt>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
    <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;Enabled&#34;</span><span class=p>,</span>
    <span class=nt>&#34;factName&#34;</span><span class=p>:</span> <span class=s2>&#34;GalleryImage&#34;</span><span class=p>,</span>
    <span class=nt>&#34;threshold&#34;</span><span class=p>:</span> <span class=s2>&#34;[concat(&#39;[&#39;, trim(parameters(&#39;allowedLabGalleryImages&#39;)), &#39;]&#39;)]&#34;</span><span class=p>,</span>
    <span class=nt>&#34;evaluatorType&#34;</span><span class=p>:</span> <span class=s2>&#34;AllowedValuesPolicy&#34;</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>And as messy as it looks, this is how to provide a parameter file value to this resource.</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=s2>&#34;allowedLabGalleryImages&#34;</span><span class=err>:</span> <span class=p>{</span>
    <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;\&#34;{\\\&#34;offer\\\&#34;:\\\&#34;WindowsServer\\\&#34;,\\\&#34;publisher\\\&#34;:\\\&#34;MicrosoftWindowsServer\\\&#34;,\\\&#34;sku\\\&#34;:\\\&#34;2019-Datacenter\\\&#34;,\\\&#34;osType\\\&#34;:\\\&#34;Windows\\\&#34;,\\\&#34;version\\\&#34;:\\\&#34;latest\\\&#34;}\&#34;,\&#34;{\\\&#34;offer\\\&#34;:\\\&#34;WindowsServer\\\&#34;,\\\&#34;publisher\\\&#34;:\\\&#34;MicrosoftWindowsServer\\\&#34;,\\\&#34;sku\\\&#34;:\\\&#34;2016-Datacenter\\\&#34;,\\\&#34;osType\\\&#34;:\\\&#34;Windows\\\&#34;,\\\&#34;version\\\&#34;:\\\&#34;latest\\\&#34;}\&#34;&#34;</span>
  <span class=p>}</span>
</code></pre></div><p>Not how I wanted it to look, at all. The above parameter value contains two image references that should help with adding additional values if you need to add more. It might help to break the value up onto multiple lines to help visualise what part you&rsquo;ll need to copy/paste.</p><h3 id=unfinished-policies>Unfinished Policies</h3><p>Unfortunately, I&rsquo;ve not managed to template for policies: <code>UserOwnedLabVmCountInSubnet</code>, <code>LabTargetCost</code>, <code>EnvironmentTemplate</code> and <code>ScheduleEditPermission</code>. I&rsquo;ll come back to them but just in case I don&rsquo;t in the near future (or, ever) I&rsquo;ve listed some references that may or may not be helpful.</p><p>My approach to find the correct values for each policy has been to make the change in the Azure Portal then retrieve the Policy details back via PowerShell. I used a couple lines of script borrowed from the <a class=link href=https://docs.microsoft.com/en-gb/azure/devtest-labs/scripts/set-allowed-vm-sizes-in-lab#sample-script target=_blank rel=noopener>DevTest Labs documentation</a></p><div class=highlight><pre class=chroma><code class=language-powershell data-lang=powershell><span class=nv>$lab</span> <span class=p>=</span> <span class=nb>Get-AzResource</span> <span class=n>-ResourceType</span> <span class=s1>&#39;Microsoft.DevTestLab/labs&#39;</span> <span class=n>-ResourceName</span> <span class=n>myDevTestLab</span>

<span class=nv>$labResourceName</span> <span class=p>=</span> <span class=nv>$lab</span><span class=p>.</span><span class=n>Name</span> <span class=p>+</span> <span class=s1>&#39;/default&#39;</span>

<span class=nv>$existingPolicy</span> <span class=p>=</span> <span class=p>(</span><span class=nb>Get-AzResource</span> <span class=n>-ResourceType</span> <span class=s1>&#39;Microsoft.DevTestLab/labs/policySets/policies&#39;</span> <span class=n>-ResourceName</span> <span class=nv>$labResourceName</span> <span class=n>-ResourceGroupName</span> <span class=nv>$lab</span><span class=p>.</span><span class=n>ResourceGroupName</span> <span class=n>-ApiVersion</span> <span class=n>2016</span><span class=p>-</span><span class=n>05</span><span class=p>-</span><span class=n>15</span><span class=p>)</span>
</code></pre></div><p>You can update $existingPolicy whenever you make a change to the policies.</p><p><code>$existingPolicy.Count</code> - will return the number of configured policy resources.
<code>$existingPolicy[0]</code> - will return the first policy configured on the DevTest lab.
<code>$existingPolicy[0].Properties</code> - will return the properties of a configured policy. It&rsquo;s this information that you&rsquo;ll need to configure policies.
In the case of at least GalleyImage you might find it easier to read if you run <code>$existingPolicy[0].Properties.threshold | ConvertFrom-Json</code></p><h3 id=references>References</h3><p><a class=link href=https://docs.microsoft.com/en-gb/azure/templates/microsoft.devtestlab/labs target=_blank rel=noopener>ARM Docs: DevTest Labs</a></p><p><a class=link href=https://docs.microsoft.com/en-gb/azure/templates/microsoft.devtestlab/labs/policysets/policies target=_blank rel=noopener>ARM Docs: DevTest Labs Policies</a></p><p><a class=link href=https://integrationworkz.antiohne.nl/2018/11/deploy-with-arm-templates-azure-devtest.html target=_blank rel=noopener>GalleryImage</a> - The blog that helped me solve GalleryImage.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/azure/>Azure</a>
<a href=/tags/devtest-labs/>DevTest Labs</a>
<a href=/tags/arm-templates/>ARM Templates</a></section></footer></article><aside class=related-contents--wrapper></aside><footer class=site-footer><section class=copyright>&copy;
2021 Matt Daines</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script></body></html>