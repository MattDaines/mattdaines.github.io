<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Matt Daines</title><link>https://blog.mattdaines.me/</link><description>Recent content on Matt Daines</description><generator>Hugo -- gohugo.io</generator><language>en-gb</language><lastBuildDate>Sun, 07 Mar 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.mattdaines.me/index.xml" rel="self" type="application/rss+xml"/><item><title>Adding a Custom Domain to your Hugo Site on Github Pages</title><link>https://blog.mattdaines.me/p/adding-a-custom-domain-to-your-hugo-site-on-github-pages/</link><pubDate>Sun, 07 Mar 2021 00:00:00 +0000</pubDate><guid>https://blog.mattdaines.me/p/adding-a-custom-domain-to-your-hugo-site-on-github-pages/</guid><description>&lt;p>Hey, hope you&amp;rsquo;re well! There&amp;rsquo;s a few prerequisites that you&amp;rsquo;ll need to meet before this walk through will be useful. Firstly, and hopefully this is obvious, you&amp;rsquo;ll need a Github Pages site published to see the end result; preferably generated by Hugo but I wouldn&amp;rsquo;t be surprised if there was some crossover to other static site generators. Secondly, you&amp;rsquo;ll need your own custom domain. Or, at least the ability to create a CNAME record in the domain you wish to configure. More on that later!&lt;/p>
&lt;p>If you haven&amp;rsquo;t yet created your static site, I&amp;rsquo;ll take the opportunity to link you to my previous post: &lt;a class="link" href="https://blog.mattdaines.me/p/getting-started-with-hugo-hosted-on-github-pages/" target="_blank" rel="noopener"
>Getting started with Hugo Hosted on Github Pages&lt;/a>. In the referenced post we configure Hugo, a static site generator and publish the site using Github Actions.&lt;/p>
&lt;p>Now, lets get stuck in.&lt;/p>
&lt;h3 id="update-github-repository-settings">Update Github Repository Settings&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>Firstly, go to your Github Pages Repository and go to Settings&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Navigate to the Github Pages section&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Add your desired custom domain. You can use either your apex domain (&lt;code>example.com&lt;/code>) or a subdomain (&lt;code>www.example.com&lt;/code> or &lt;code>blog.example.com&lt;/code>).&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>So what does this do? After selecting save, Github commits a single file named &lt;code>CNAME&lt;/code> to your publishing branch. If you&amp;rsquo;re unsure what your publishing branch is, it&amp;rsquo;s the branch shown under source just above the custom domain settings. The problem with this is that when Hugo builds our site through Github Actions that CNAME file is removed. So hold off pushing any new changes that will trigger the Github Action for now! Next we&amp;rsquo;ll configure our Custom Domain&amp;rsquo;s DNS.&lt;/p>
&lt;h3 id="update-your-dns-settings">Update your DNS Settings&lt;/h3>
&lt;p>First, you&amp;rsquo;ll need to decide whether you&amp;rsquo;re going to use your apex domain or a subdomain for your site. Once that&amp;rsquo;s decided, you only need to go through one of the sub sections below.&lt;/p>
&lt;h4 id="using-a-subdomain">Using a Subdomain&lt;/h4>
&lt;ol>
&lt;li>
&lt;p>Go to where you manage your domain&amp;rsquo;s DNS configuration. Usually, that is your domain registrar.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Add a CNAME record pointing to your Github Page. For me, that means adding a new CNAME record named &lt;code>blog&lt;/code> pointing to &lt;code>mattdaines.github.io&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>Initially, I started with a low time-to-live (TTL) for the record. Once I was confident everything was setup and working correctly, I upped the TTL to 24 hours.&lt;/p>
&lt;p>At the time of writing I don&amp;rsquo;t use my apex domain for anything in particular. So, I&amp;rsquo;ve also setup forwarding on my apex domain to redirect requests to this blog.&lt;/p>
&lt;h4 id="using-an-apex-domain">Using an Apex Domain&lt;/h4>
&lt;p>As I use a subdomain I&amp;rsquo;m less familiar with adding the apex domain as a custom domain but the process appears to be largely similar to adding a subdomain.&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Go to where you manage your domain&amp;rsquo;s DNS configuration. Usually, that is your domain registrar.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Add an A record pointing to the addresses documented in the &lt;a class="link" href="https://docs.github.com/en/github/working-with-github-pages/managing-a-custom-domain-for-your-github-pages-site#configuring-an-apex-domain" target="_blank" rel="noopener"
>Github Pages documentation&lt;/a>.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="preventing-cname-file-being-removed-by-github-actions">Preventing CNAME file being removed by Github Actions&lt;/h3>
&lt;p>So, now that we have a custom domain configured how do we prevent our static site generator from removing the required CNAME file that Github creates? Fortunately, with Hugo it&amp;rsquo;s pretty simple!&lt;/p>
&lt;ol>
&lt;li>
&lt;p>In your site root, create a directory named &lt;code>static&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Create a file named &lt;code>CNAME&lt;/code> - make sure there&amp;rsquo;s no file extension&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Add your custom domain name to this file. For my site that would mean a file containing &lt;code>blog.mattdaines.me&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>Remember, you can always reference your publishing branch to check how this file should look.&lt;/p>
&lt;p>Before we push/PR any changes we should check that this static file is generated.&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Open a console to the root of your site&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Run &lt;code>hugo&lt;/code> to build the site&lt;/p>
&lt;/li>
&lt;li>
&lt;p>The site will publish locally under a directory named &lt;code>public&lt;/code>. In the public directory you should see a file named &lt;code>CNAME&lt;/code>, in all capital letters. The file should contain your custom domain on a single line with no trailing spaces.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="references">References&lt;/h3>
&lt;p>And that&amp;rsquo;s it! Here are some references that helped me.&lt;/p>
&lt;p>&lt;a class="link" href="https://docs.github.com/en/github/working-with-github-pages/managing-a-custom-domain-for-your-github-pages-site#configuring-a-subdomain" target="_blank" rel="noopener"
>Github Pages - Custom Domain with Subdomain&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://docs.github.com/en/github/working-with-github-pages/managing-a-custom-domain-for-your-github-pages-site#configuring-an-apex-domain" target="_blank" rel="noopener"
>Github Pages - Custom Domain with Apex Domain&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://gohugo.io/hosting-and-deployment/hosting-on-github#use-a-custom-domain" target="_blank" rel="noopener"
>Hugo - Using a Custom Domain&lt;/a>&lt;/p></description></item><item><title>Getting Started with Hugo hosted on Github Pages</title><link>https://blog.mattdaines.me/p/getting-started-with-hugo-hosted-on-github-pages/</link><pubDate>Sat, 06 Mar 2021 00:00:00 +0000</pubDate><guid>https://blog.mattdaines.me/p/getting-started-with-hugo-hosted-on-github-pages/</guid><description>&lt;p>The site you&amp;rsquo;re reading now is hosted on Github for free, powered by Github Pages, Hugo (a static site generator) and &lt;a class="link" href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener"
>Jimmy&amp;rsquo;s Stack Theme&lt;/a>. This post will describe how to achieve either the same or similar thing for yourself!&lt;/p>
&lt;p>I&amp;rsquo;ve wanted a tech blog for a while I&amp;rsquo;ve started a few only to abandon them and start over a few months later. I just couldn&amp;rsquo;t figure out how I wanted to do it. I first heard about Static blog generators through a Pluralsight video course so I started to look up how I could use a static site generator like Jekyll or Hugo to manage my own blog. I&amp;rsquo;m not a web developer so I knew I wanted something to abstract the complexity away. That&amp;rsquo;s why many blogs before had failed - high maintenance. I might have finally settled on a solution!&lt;/p>
&lt;h3 id="installing-hugo">Installing Hugo&lt;/h3>
&lt;p>Now, I&amp;rsquo;m running on Windows 10 so my experience may differ to yours if you&amp;rsquo;re running on a different operating system.&lt;/p>
&lt;ol>
&lt;li>
&lt;p>In the next step, we use &lt;a class="link" href="https://chocolatey.org/install" target="_blank" rel="noopener"
>Chocolatey&lt;/a> to install Hugo on your machine. Chocolatey has a PowerShell one-liner that should install Chocolatey on your machine&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Hugo&amp;rsquo;s &lt;a class="link" href="https://gohugo.io/getting-started/installing" target="_blank" rel="noopener"
>documentation&lt;/a> gives you many methods to install Hugo on your machine. I used &lt;a class="link" href="https://gohugo.io/getting-started/installing#chocolatey-windows" target="_blank" rel="noopener"
>Chocolatey&lt;/a> to install Hugo. I had no issues here and Hugo was setup very quickly&lt;/p>
&lt;/li>
&lt;li>
&lt;p>If everything is setup correctly, running &lt;code>hugo version&lt;/code> in a console should return something like: &lt;code>Hugo Static Site Generator v0.78.1-347F2DE6 windows/amd64 BuildDate: 2020-11-05T09:42:11Z&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="github-repository-setup">Github Repository Setup&lt;/h3>
&lt;p>Github Pages can be setup either per user, organisation or project. For this site, I&amp;rsquo;m creating a user site.&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Create a &lt;strong>public&lt;/strong> Repository named &lt;code>&amp;lt;YourGithubUserName.github.io&amp;gt;&lt;/code>. For a user site, the repository must be public.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Create a branch that will be used for the published site. To keep things simple, I kept the default &lt;code>gh-pages&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Go to the repository settings, then find the Github Pages section and select the Source branch you just created. For the directory, I&amp;rsquo;m using &lt;code>/(root)&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Not required but if it&amp;rsquo;s not enabled, why not enable &lt;code>Enforce HTTPS&lt;/code> while we&amp;rsquo;re here.&lt;/p>
&lt;p>&lt;a class="link" href="https://blog.mattdaines.me/p/adding-a-custom-domain-to-your-hugo-site-on-github-pages/" target="_blank" rel="noopener"
>Be sure to checkout my post on how to add a custom domain to your Github Page!&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Clone your new repository to your machine and open a console at the root of the local repository&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="new-hugo-site">New Hugo Site&lt;/h3>
&lt;ol>
&lt;li>With your console open and at the root of your new repository run &lt;code>hugo new site .&lt;/code>&lt;/li>
&lt;/ol>
&lt;p>The &lt;code>.&lt;/code> represents this directory. If you prefer, you could run &lt;code>hugo new site blog&lt;/code> to build the static site in a new directory under the repository root. If you opt to do this, check that your file paths are updated to reflect the change.&lt;/p>
&lt;h3 id="building-and-running-the-site-locally">Building and running the site locally&lt;/h3>
&lt;p>It&amp;rsquo;s likely that you&amp;rsquo;ll want view your site as you go through and make changes. Of course, you don&amp;rsquo;t need to but it&amp;rsquo;s a good way of being able to tell when something has broken. All of these commands should be run on the root of the site. For me, that&amp;rsquo;s at the repository root.&lt;/p>
&lt;ul>
&lt;li>&lt;code>hugo&lt;/code> will just build the site&lt;/li>
&lt;li>&lt;code>hugo server&lt;/code> will build changed parts of the site and serve the site on &lt;a class="link" href="http://localhost:1313/" target="_blank" rel="noopener"
>localhost:1313&lt;/a>&lt;/li>
&lt;li>&lt;code>hugo server --disableFastRender&lt;/code> will build the entire site and serve on &lt;a class="link" href="http://localhost:1313/" target="_blank" rel="noopener"
>localhost:1313&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>I typically run the third command. As my site is currently quite small, it takes less than a second for the site to rebuild.&lt;/p>
&lt;h3 id="gitignore">Gitignore&lt;/h3>
&lt;p>If you ran &lt;code>hugo&lt;/code> or &lt;code>hugo server&lt;/code> by now you might have noticed that you have a load of changes. These aren&amp;rsquo;t required and are the generated when the site builds. To get around this I two directories to my .gitignore: &lt;code>/public&lt;/code> and &lt;code>/resources&lt;/code>. You may choose to add more but those two reduced the noise significantly.&lt;/p>
&lt;h3 id="adding-a-hugo-theme">Adding a Hugo Theme&lt;/h3>
&lt;p>There are a large number of Hugo Themes available. Always check the theme&amp;rsquo;s documentation to get started. Generally, from what I&amp;rsquo;ve seen the process is similar though. I use the &lt;a class="link" href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener"
>Stack Hugo Theme&lt;/a> and the guide will work to implement this theme.&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Choose your &lt;a class="link" href="https://themes.gohugo.io" target="_blank" rel="noopener"
>Hugo Themes&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Clone your chosen theme into your themes directory: &lt;code>git clone https://github.com/CaiJimmy/hugo-theme-stack/ themes/hugo-theme-stack&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Add a your theme as a submodule &lt;code>git submodule add https://github.com/CaiJimmy/hugo-theme-stack/ themes/hugo-theme-stack&lt;/code>&lt;/p>
&lt;p>This step is important as it&amp;rsquo;ll ensure you&amp;rsquo;re cloning the latest theme whenever you publish a new post. I guess another way to do this is to this is to run step 2 whenever you want to update the theme.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Delete the &lt;code>config.toml&lt;/code> where you first created the site.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Copy &lt;code>themes/hugo-theme-stack/exampleSite/config.yaml&lt;/code> to the site root.&lt;/p>
&lt;p>This is where you can change various settings for your site. Feel free to take a look now, if you&amp;rsquo;d like.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="setting-up-github-actions-to-publish-new-posts">Setting up Github Actions to publish new posts&lt;/h3>
&lt;p>&lt;a class="link" href="https://gohugo.io/hosting-and-deployment/hosting-on-github#build-hugo-with-github-action" target="_blank" rel="noopener"
>Hugo has a very clear guide&lt;/a> for building a static generated site on Github Pages. This is how my Github action started. I&amp;rsquo;ve made some changes to Hugo&amp;rsquo;s documentation such as:&lt;/p>
&lt;ul>
&lt;li>Adding &lt;code>paths-ignore&lt;/code> to not trigger when I&amp;rsquo;m updating something that isn&amp;rsquo;t related to the site.&lt;/li>
&lt;li>Updated &lt;code>runs-on&lt;/code> to &lt;code>ubuntu-latest&lt;/code>. If I need to change this to an older version because of some breaking change, I can. Until then though, I&amp;rsquo;d rather use the latest images.&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">github pages&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">push&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">branches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">main&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">paths-ignore&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s1">&amp;#39;README.md&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s1">&amp;#39;.gitignore&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s1">&amp;#39;.gitmodules&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">jobs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">deploy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">runs-on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ubuntu-latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">steps&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">actions/checkout@v2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">submodules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-depth&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Setup Hugo&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">peaceiris/actions-hugo@v2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hugo-version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;latest&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Build&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hugo --minify&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deploy&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">peaceiris/actions-gh-pages@v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">github_token&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.GITHUB_TOKEN }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">publish_dir&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">./public&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="references">References&lt;/h3>
&lt;p>And that&amp;rsquo;s it! Here are some references that helped me get setup.&lt;/p>
&lt;p>&lt;a class="link" href="https://chocolatey.org" target="_blank" rel="noopener"
>Chocolatey&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://gohugo.io" target="_blank" rel="noopener"
>Hugo&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://docs.github.com/en/github/working-with-github-pages" target="_blank" rel="noopener"
>Github Pages&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://themes.gohugo.io" target="_blank" rel="noopener"
>Hugo Themes&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener"
>Stack Hugo Theme&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://docs.stack.jimmycai.com" target="_blank" rel="noopener"
>Stack Hugo Theme Documentation&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/peaceiris/actions-gh-pages" target="_blank" rel="noopener"
>Github Github Pages Actions&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://gohugo.io/hosting-and-deployment/hosting-on-github" target="_blank" rel="noopener"
>Hugo Hosting on Github&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://app.pluralsight.com/library/courses/static-site-generator-build-better-blog" target="_blank" rel="noopener"
>Pluralsight Course: Build a Better Blog with a Static Site Generator&lt;/a> - Subscription likely required!&lt;/p></description></item><item><title>Building DevTest Labs ARM Template Policies</title><link>https://blog.mattdaines.me/p/building-devtest-labs-arm-template-policies/</link><pubDate>Mon, 15 Feb 2021 00:00:00 +0000</pubDate><guid>https://blog.mattdaines.me/p/building-devtest-labs-arm-template-policies/</guid><description>&lt;p>I&amp;rsquo;ve recently been ARM templating again! In this article I&amp;rsquo;ll go through how I&amp;rsquo;ve templated a relatively troublesome resource: &lt;code>Microsoft.DevTestLab/labs/policysets/policies&lt;/code>. The documentation for this resource type is quite scarce so I figured I&amp;rsquo;d try figure out how to template at least some of the policies. Maybe you&amp;rsquo;ll find something useful.&lt;/p>
&lt;h3 id="devtest-labs-parent-resource">DevTest Labs Parent Resource&lt;/h3>
&lt;p>This resource is relatively simple; shouldn&amp;rsquo;t have too much of an issue here! Not going into detail here but for completeness, this is what I used as my parent.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;[parameters(&amp;#39;devTestLabName&amp;#39;)]&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Microsoft.DevTestLab/labs&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;apiVersion&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2018-09-15&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;location&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;[parameters(&amp;#39;location&amp;#39;)]&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;properties&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;labStorageType&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Premium&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;premiumDataDisks&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Enabled&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="userownedlabvmcount">UserOwnedLabVmCount&lt;/h3>
&lt;p>This is where I first realised that threshold only accepts a string. My first assumption was that another field (factData) held strings and threshold held integers. That&amp;rsquo;s not the case.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;[concat(parameters(&amp;#39;devTestLabName&amp;#39;), &amp;#39;/default/UserOwnedLabVmCount&amp;#39;)]&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Microsoft.DevTestLab/labs/policysets/policies&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;apiVersion&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2018-09-15&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dependsOn&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;[resourceId(&amp;#39;Microsoft.DevTestLab/labs&amp;#39;, parameters(&amp;#39;devTestLabName&amp;#39;))]&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;properties&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;status&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Enabled&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;factName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;UserOwnedLabVmCount&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;threshold&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;evaluatorType&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;MaxValuePolicy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>There doesn&amp;rsquo;t appear to be a max value for UserOwnedLabVmCount. I tried 999,999 and it took. If that&amp;rsquo;s something you&amp;rsquo;d like to control in a parameter you can use a parameter of type int where you can set maxValue then for the threshold property use:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;threshold&amp;#34;&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="s2">&amp;#34;[string(parameter(&amp;#39;UserOwnedLabVmCountValue&amp;#39;))]&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="userownedlabpremiumvmcount">UserOwnedLabPremiumVmCount&lt;/h3>
&lt;p>Practically identical to the above!&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;[concat(parameters(&amp;#39;devTestLabName&amp;#39;), &amp;#39;/default/UserOwnedLabPremiumVmCount&amp;#39;)]&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Microsoft.DevTestLab/labs/policysets/policies&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;apiVersion&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2018-09-15&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dependsOn&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;[resourceId(&amp;#39;Microsoft.DevTestLab/labs&amp;#39;, parameters(&amp;#39;devTestLabName&amp;#39;))]&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;properties&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;status&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Enabled&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;factName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;UserOwnedLabPremiumVmCount&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;threshold&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;evaluatorType&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;MaxValuePolicy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="labvmcount">LabVmCount&lt;/h3>
&lt;p>Another practically identical resource to the two previous policies&amp;hellip; If only they were all this easy!&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;[concat(parameters(&amp;#39;devTestLabName&amp;#39;), &amp;#39;/default/LabVmCount&amp;#39;)]&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Microsoft.DevTestLab/labs/policysets/policies&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;apiVersion&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2018-09-15&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dependsOn&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;[resourceId(&amp;#39;Microsoft.DevTestLab/labs&amp;#39;, parameters(&amp;#39;devTestLabName&amp;#39;))]&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;properties&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;status&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Enabled&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;factName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;LabVmCount&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;threshold&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;evaluatorType&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;MaxValuePolicy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="labpremiumvmcount">LabPremiumVmCount&lt;/h3>
&lt;p>And again&amp;hellip; But this time a little caveat. This policy requires that the DevTest lab property &lt;code>labStorageType&lt;/code> is set to &lt;code>Premium&lt;/code>. ARM will throw a seemingly unrelated error if this is not set. I learnt this as initially my DevTest lab was set to StandardSSD.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;[concat(parameters(&amp;#39;devTestLabName&amp;#39;), &amp;#39;/default/LabPremiumVmCount&amp;#39;)]&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Microsoft.DevTestLab/labs/policysets/policies&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;apiVersion&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2018-09-15&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dependsOn&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;[resourceId(&amp;#39;Microsoft.DevTestLab/labs&amp;#39;, parameters(&amp;#39;devTestLabName&amp;#39;))]&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;properties&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;status&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Enabled&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;factName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;LabPremiumVmCount&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;threshold&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;evaluatorType&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;MaxValuePolicy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="labvmsize">LabVmSize&lt;/h3>
&lt;p>Okay, this one is different. Really. It&amp;rsquo;s our first policy that doesn&amp;rsquo;t just require a integer (.. as a string).&lt;/p>
&lt;p>The solution for LabVmSize is to use a parameter of type array and parse that as a string. The array is just your standard Azure VM sizes in a list. To be verbose, this is the template resource component:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;[concat(parameters(&amp;#39;devTestLabName&amp;#39;), &amp;#39;/default/LabVmSize&amp;#39;)]&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Microsoft.DevTestLab/labs/policysets/policies&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;apiVersion&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2018-09-15&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dependsOn&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;[resourceId(&amp;#39;Microsoft.DevTestLab/labs&amp;#39;, parameters(&amp;#39;devTestLabName&amp;#39;))]&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;properties&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;status&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Enabled&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;factName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;LabVmSize&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;threshold&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;[string(parameters(&amp;#39;allowedLabVmSizes&amp;#39;))]&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;evaluatorType&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;AllowedValuesPolicy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And the parameter component:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;allowedLabVmSizes&amp;#34;&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;value&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Basic_A0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Basic_A1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Basic_A2&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Basic_A3&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Basic_A4&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="galleryimage">GalleryImage&lt;/h3>
&lt;p>This one beat me. I searched for &lt;code>&amp;quot;/default/GalleryImage&amp;quot;&lt;/code> and found another blog that had managed to template this value. I wonder if they struggled as much as I did.&lt;/p>
&lt;p>At first glance this policy is very similar to the one directly above. It accepts a JSON array as a string containing the usual details about the image reference. But for reasons that are beyond my comprehension they wouldn&amp;rsquo;t stick. So, this is the template:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;[concat(parameters(&amp;#39;devTestLabName&amp;#39;), &amp;#39;/default/GalleryImage&amp;#39;)]&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Microsoft.DevTestLab/labs/policysets/policies&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;apiVersion&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2018-09-15&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dependsOn&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;[resourceId(&amp;#39;Microsoft.DevTestLab/labs&amp;#39;, parameters(&amp;#39;devTestLabName&amp;#39;))]&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;properties&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;status&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Enabled&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;factName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;GalleryImage&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;threshold&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;[concat(&amp;#39;[&amp;#39;, trim(parameters(&amp;#39;allowedLabGalleryImages&amp;#39;)), &amp;#39;]&amp;#39;)]&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;evaluatorType&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;AllowedValuesPolicy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And as messy as it looks, this is how to provide a parameter file value to this resource.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;allowedLabGalleryImages&amp;#34;&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;value&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;\&amp;#34;{\\\&amp;#34;offer\\\&amp;#34;:\\\&amp;#34;WindowsServer\\\&amp;#34;,\\\&amp;#34;publisher\\\&amp;#34;:\\\&amp;#34;MicrosoftWindowsServer\\\&amp;#34;,\\\&amp;#34;sku\\\&amp;#34;:\\\&amp;#34;2019-Datacenter\\\&amp;#34;,\\\&amp;#34;osType\\\&amp;#34;:\\\&amp;#34;Windows\\\&amp;#34;,\\\&amp;#34;version\\\&amp;#34;:\\\&amp;#34;latest\\\&amp;#34;}\&amp;#34;,\&amp;#34;{\\\&amp;#34;offer\\\&amp;#34;:\\\&amp;#34;WindowsServer\\\&amp;#34;,\\\&amp;#34;publisher\\\&amp;#34;:\\\&amp;#34;MicrosoftWindowsServer\\\&amp;#34;,\\\&amp;#34;sku\\\&amp;#34;:\\\&amp;#34;2016-Datacenter\\\&amp;#34;,\\\&amp;#34;osType\\\&amp;#34;:\\\&amp;#34;Windows\\\&amp;#34;,\\\&amp;#34;version\\\&amp;#34;:\\\&amp;#34;latest\\\&amp;#34;}\&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Not how I wanted it to look, at all. The above parameter value contains two image references that should help with adding additional values if you need to add more. It might help to break the value up onto multiple lines to help visualise what part you&amp;rsquo;ll need to copy/paste.&lt;/p>
&lt;h3 id="unfinished-policies">Unfinished Policies&lt;/h3>
&lt;p>Unfortunately, I&amp;rsquo;ve not managed to template for policies: &lt;code>UserOwnedLabVmCountInSubnet&lt;/code>, &lt;code>LabTargetCost&lt;/code>, &lt;code>EnvironmentTemplate&lt;/code> and &lt;code>ScheduleEditPermission&lt;/code>. I&amp;rsquo;ll come back to them but just in case I don&amp;rsquo;t in the near future (or, ever) I&amp;rsquo;ve listed some references that may or may not be helpful.&lt;/p>
&lt;p>My approach to find the correct values for each policy has been to make the change in the Azure Portal then retrieve the Policy details back via PowerShell. I used a couple lines of script borrowed from the &lt;a class="link" href="https://docs.microsoft.com/en-gb/azure/devtest-labs/scripts/set-allowed-vm-sizes-in-lab#sample-script" target="_blank" rel="noopener"
>DevTest Labs documentation&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$lab&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">Get-AzResource&lt;/span> &lt;span class="n">-ResourceType&lt;/span> &lt;span class="s1">&amp;#39;Microsoft.DevTestLab/labs&amp;#39;&lt;/span> &lt;span class="n">-ResourceName&lt;/span> &lt;span class="n">myDevTestLab&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$labResourceName&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nv">$lab&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Name&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="s1">&amp;#39;/default&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$existingPolicy&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nb">Get-AzResource&lt;/span> &lt;span class="n">-ResourceType&lt;/span> &lt;span class="s1">&amp;#39;Microsoft.DevTestLab/labs/policySets/policies&amp;#39;&lt;/span> &lt;span class="n">-ResourceName&lt;/span> &lt;span class="nv">$labResourceName&lt;/span> &lt;span class="n">-ResourceGroupName&lt;/span> &lt;span class="nv">$lab&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ResourceGroupName&lt;/span> &lt;span class="n">-ApiVersion&lt;/span> &lt;span class="n">2016&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="n">05&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="n">15&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>You can update $existingPolicy whenever you make a change to the policies.&lt;/p>
&lt;p>&lt;code>$existingPolicy.Count&lt;/code> - will return the number of configured policy resources.
&lt;code>$existingPolicy[0]&lt;/code> - will return the first policy configured on the DevTest lab.
&lt;code>$existingPolicy[0].Properties&lt;/code> - will return the properties of a configured policy. It&amp;rsquo;s this information that you&amp;rsquo;ll need to configure policies.
In the case of at least GalleyImage you might find it easier to read if you run &lt;code>$existingPolicy[0].Properties.threshold | ConvertFrom-Json&lt;/code>&lt;/p>
&lt;h3 id="references">References&lt;/h3>
&lt;p>&lt;a class="link" href="https://docs.microsoft.com/en-gb/azure/templates/microsoft.devtestlab/labs" target="_blank" rel="noopener"
>ARM Docs: DevTest Labs&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://docs.microsoft.com/en-gb/azure/templates/microsoft.devtestlab/labs/policysets/policies" target="_blank" rel="noopener"
>ARM Docs: DevTest Labs Policies&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://integrationworkz.antiohne.nl/2018/11/deploy-with-arm-templates-azure-devtest.html" target="_blank" rel="noopener"
>GalleryImage&lt;/a> - The blog that helped me solve GalleryImage.&lt;/p></description></item></channel></rss>